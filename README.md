#  Telegram бот для контроля статуса домашнего задания

##  Описание
Telegram-бота, который обращается к API сервису Практикум.Домашка и узнавает статус вашей домашней работы:
взята ли ваша домашка в ревью, проверена ли она, а если проверена — то принял её ревьюер или вернул на доработку

##  Используемые технологии
- Python
- Python-Telegram-Bot

##  Функциональность
Бот умеет:
- раз в 10 минут опрашивает API сервис Практикум.Домашка и проверяет статус отправленной на ревью домашней работы
- при обновлении статуса анализирует ответ API и отправляет вам соответствующее уведомление в Telegram
- логирует свою работу и сообщает вам о важных проблемах сообщением в Telegram

##  Запуск проекта локально
- Клонировать репозиторий
```
git@github.com:Oleg-2006/homework_bot.git
```
- Перейти в новую директорию
```
cd homework_bot/
```
- Инициализировать виртуальное окружение
```
python -m venv venv
```
- Активировать виртуальное окружение
```
source venv/Scripts/activate
```
- Установить зависимости проекта
```
pip install -r requirements.txt
```
- Настройка переменных окружения
Создать файл .env, в котором прописать идентификаторы и токены для работы с API Telegram и Яндекс.Домашка:
    * Указать свой токен сервиса Практикум.Домашка
    ```
    PRACTICUM_TOKEN=<PRACTICUM_TOKEN>
    ```
    * Указать API-токен бота Telegram. (При помощи @BotFather в Telegram создайте нового бота и получите API TOKEN)
    ```
    TELEGRAM_TOKEN=<API TOKEN>
    ```
    * Указать идентификатор Telegram, на который бот будет слать сообщения (узнать у @userinfobot):
    ```
    TELEGRAM_CHAT_ID=<TELEGRAM_CHAT_ID>
    ```
- В корневой директории выполните команду для запуска бот
```
python homework.py
```
##  Запуск проекта на сервере
для примера используется хостинг Heroku
- Зарегистрируйтесь на Heroku
- Создайте приложение (кнопка New → Create new app).
  Придумайте и укажите название для приложения. Выберите географически близкий к вам регион.
- Теперь свяжите ваш аккаунт Heroku c GitHub: в интерфейсе Heroku зайдите в раздел Deploy,
  в разделе Deployment method выберите GitHub и нажмите на кнопку Connect to GitHu
  Чтобы связать аккаунты — вам будет предложено аутентифицироваться через GitHub.
  Затем в открывшемся окне укажите название репозитория, в котором находится код.
  Осталось только нажать на кнопку Deploy Branch: Heroku установит все зависимости и опубликует приложение на сервере.
  Чтобы всё запустилось, в репозиторий нужно поместить два служебных файла:
    - **requirements.txt** со списком зависимостей, чтобы Heroku знал, какие пакеты ему нужно установить;
    - файл **Procfile**, в котором должна быть указана «точка входа» — файл, который должен быть выполнен для запуска проекта.

- Добавьте `PRACTICUM_TOKEN`, `TELEGRAM_TOKEN`, `TELEGRAM_CHAT_ID`
  Добавить переменные окружения можно вручную в настройках Heroku, в разделе Settings → Config Vars

- Запустите бот. Перейдите во вкладку Resources и активируйте переключатель напротив строки worker python homework.py.
  Для этого нажмите на пиктограмму с карандашом справа от переключателя,
  активируйте переключатель и подтвердите действие, нажав на появившуюся кнопку Confirm.

[Здесь](https://github.com/heroku/python-sample) доступен пример размещения проекта на Heroku
Подробные инструкции есть в [документации](https://devcenter.heroku.com/categories/deployment)

##  Описание функций
- `main()` в ней описана основная логика работы программы. 
Все остальные функции  запуска.ncz из неё. 
Последовательность действий такая:
    - Сделать запрос к API.
    - Проверить ответ.
    - Если есть обновления — получить статус работы из обновления и отправить сообщение в Telegram.
    - Подождать некоторое время и сделать новый запрос.

- `check_tokens()` проверяет доступность переменных окружения, которые необходимы для работы программы.
Если отсутствует хотя бы одна переменная окружения — функция возвращает False, иначе — True.

- `get_api_answer()` делает запрос к единственному эндпоинту API-сервиса.
В качестве параметра функция получает временную метку.
В случае успешного запроса возвращает ответ API, преобразовав его из формата JSON к типам данных Python.

- `check_response()` проверяет ответ API на корректность.
В качестве параметра функция получает ответ API, приведенный к типам данных Python.
Если ответ API соответствует ожиданиям, то функция возвращает список домашних работ (он может быть и пустым),
доступный в ответе API по ключу 'homeworks'.

- `parse_status()` извлекает из информации о конкретной домашней работе статус этой работы.
В качестве параметра функция получает только один элемент из списка домашних работ.
В случае успеха, функция возвращает подготовленную для отправки в Telegram строку,
содержащую один из вердиктов словаря HOMEWORK_STATUSES.

- `send_message()` отправляет сообщение в Telegram чат, определяемый переменной окружения TELEGRAM_CHAT_ID.
Принимает на вход два параметра: экземпляр класса Bot и строку с текстом сообщения.

##  Логирование
Логируемые события:
- отсутствие обязательных переменных окружения во время запуска бота (уровень **CRITICAL**)
- удачная отправка любого сообщения в Telegram (уровень **INFO**)
- сбой при отправке сообщения в Telegram (уровень **ERROR**)
- недоступность эндпоинта https://practicum.yandex.ru/api/user_api/homework_statuses/ (уровень **ERROR**)
- любые другие сбои при запросе к эндпоинту (уровень **ERROR**)
- отсутствие ожидаемых ключей в ответе API (уровень **ERROR**);
- недокументированный статус домашней работы, обнаруженный в ответе API (уровень **ERROR**);
- отсутствие в ответе новых статусов (уровень **DEBUG**).

События уровня ERROR не только логируются, но и пересылается информацию о них в ваш Telegram в тех случаях,
когда это технически возможно (если API Telegram перестанет отвечать или при старте программы не окажется
нужной переменной окружения — ничего отправить не получится).

